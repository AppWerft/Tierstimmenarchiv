const DURATION=2e4,HEIGHT=150;var TSA=new(require("model/tsa.adapter")),Row=require("ui/record.row");module.exports=function(e){var i=TSA.getRecordById(e.itemId);if(!i)return void console.log("Warning: no record");var t=Ti.UI.createWindow({backgroundColor:COLOR.DARKGREEN,orientationModes:[Titanium.UI.PORTRAIT]});t.imageView=Ti.UI.createView({});var a=Ti.UI.createTableViewRow({height:Ti.UI.SIZE,itemId:JSON.stringify({mod:"zoom.window",id:i.species_latin})});a.add(t.imageView),t.listView=Ti.UI.createTableView({top:0,data:[a],height:Ti.UI.FILL,backgroundColor:"transparent"}),t.listView.appendRow(Row("",i.species+" "+i.erstbeschreibung)),i.Beschreibung&&t.listView.appendRow(Row(i.Beschreibung,"")),i.ort&&t.listView.appendRow(Row("Aufnahme:",i.ort+", "+i.country+", "+i.cdate)),i.allRecordsOfSpeciesWithLatLng.records.length>0&&(t.mapView=require("ui/map.row")(i),t.listView.appendRow(t.mapView)),i.deutscher_name&&t.listView.appendRow(Row("deutscher Name:",i.deutscher_name)),i.english_name&&t.listView.appendRow(Row("englischer Name:",i.english_name)),t.listView.appendRow(Row("Familie:",i.families_de+" ("+i.families_latin+")")),t.listView.appendRow(Row("Ordnung:",i.orders_de+" ("+i.orders_latin+")")),i.Autor&&t.listView.appendRow(Row("Autor:",i.Autor)),t.listView.appendRow(Row("Copyright:","CC BY-NC-SA")),t.listView.appendRow(Row("","        \n\n\n\n\n\n\n\n\n\n\n")),t.listView.addEventListener("click",function(e){if(e.row.itemId){var i=JSON.parse(e.row.itemId);i.id&&require("ui/"+i.mod)(i.id).open()}}),i.autor&&t.listView.appendRow(Row("Autor",i.Autor)),new(require("vendor/wikimedia.adapter"))(i.species_latin,{onload:function(e){t.imageView.backgroundImage=e.nativePath;var i=parseFloat(e.height)/parseFloat(e.width)*parseFloat(Ti.Platform.displayCaps.platformWidth)/parseFloat(Ti.Platform.displayCaps.logicalDensityFactor);t.imageView.setHeight(i),t.listView.data[0].setHeight(i),t.listView.setTop(0),t.imageView.add(Ti.UI.createImageView({image:"/assets/wikispecies.png",top:0,right:0,width:50,height:"auto",zIndex:99,opacity:.7}))}});var r=Ti.Media.createAudioPlayer({url:i.audio,allowBackground:!0,volume:1});r.addEventListener("change",function(e){if(3==e.state){t.playerView.animate({bottom:0});var i=r.duration||DURATION;t.playerView.darker&&t.playerView.darker.animate({width:0,duration:i})}}),r.addEventListener("complete",function(e){t.playerView.animate({bottom:-150}),e.error&&Ti.Android&&Ti.UI.createNotification({message:"Der sound kann nicht abgespielt werden.\nGerät nicht im Netz?"}).show()}),t.playerView=Ti.UI.createView({backgroundColor:"black",bottom:-150,height:HEIGHT}),t.playerView.add(Ti.UI.createImageView({width:Ti.UI.FILL,height:Ti.UI.FILL,image:i.spectrogram})),t.playerView.darker=Ti.UI.createView({backgroundColor:"#cfff",width:"100%",right:0}),t.playerView.add(t.playerView.darker),t.add(t.listView),t.add(t.playerView),t.addEventListener("close",function(){t.mapView&&t.mapView.removeAllChildren(),r.pause(),r.stop(),r.release(),r=null}),t.addEventListener("open",function(e){if(Ti.Android){var a=require("com.alcoapps.actionbarextras");a.setTitle("Tierstimmenarchiv"),a.setFont("Helvetica-Bold"),a.setSubtitle(i.species),a.displayUseLogoEnabled=!1,a.setStatusbarColor(COLOR.BROWN),a.backgroundColor=COLOR.DARKGREEN,e.source.getActivity().actionBar.displayHomeAsUp=!0;var r=e.source.getActivity();r.actionBar.onHomeIconItemSelected=function(){t.close()},r.onCreateOptionsMenu=function(e){e.menu.clear(),e.menu.add({title:"Favorite",itemId:1,showAsAction:Ti.Android.SHOW_AS_ACTION_IF_ROOM,checked:!1,icon:Ti.App.Android.R.drawable.ic_action_favorite_add}).addEventListener("click",function(e){e.source.icon=e.source.icon==Ti.App.Android.R.drawable.ic_action_favorite_add?Ti.App.Android.R.drawable.ic_action_favorite:Ti.App.Android.R.drawable.ic_action_favorite_add,alert("Merkzettel ist noch nicht umgesetzt.")}),e.menu.add({title:"Klingelton",itemId:2,showAsAction:Ti.Android.SHOW_AS_ACTION_IF_ROOM,icon:Ti.App.Android.R.drawable.ic_action_ringtone}).addEventListener("click",function(){alert("Klingelton ist noch nicht umgesetzt.")})}}}),t.open(),r.start()};