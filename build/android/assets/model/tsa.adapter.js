const DBNAME="TSAxx";var Module=function(){this.eventhandlers=[]};Module.prototype={Import_isDone:function(){return Ti.App.Properties.hasProperty(DBNAME)},Import_Init:function(){var e=(new Date).getTime();this.rows=JSON.parse(Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory,"model","tsa.json").read().text).Workbook.Worksheet.Table.Row,console.log("durationJSONparsing :"+((new Date).getTime()-e))},Import_loadTaxo:function(){const e=0,t=6,i=9,a=11;var s=(new Date).getTime(),r={},n={},o=Ti.Database.open(DBNAME);Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory,"model","init.sql").read().text.split("\n").forEach(function(e){e.length>1&&o.execute(e)}),console.log("durationCREATING TABLES :"+((new Date).getTime()-s)),s=(new Date).getTime(),o.execute("PRAGMA synchronous = OFF"),o.execute("BEGIN TRANSACTION");return this.rows.forEach(function(s,l){if(l>0&&Array.isArray(s.C)&&30==s.C.length&&!r[s.C[e]]&&!n[s.C[t]]){var c=s.C;o.execute("INSERT INTO species VALUES (?,?,?,?)",c[e],c[6],c[5],c[4]),o.execute("INSERT INTO families VALUES (?,?,?,?)",c[t],c[9],c[8],c[7]),o.execute("INSERT OR REPLACE INTO orders VALUES (?,?,?,?)",c[i],c[11],"",c[10]),o.execute("INSERT OR REPLACE INTO classes VALUES (?,?,?)",c[a],"",""),r[c[e]]=!0,n[c[t]]=!0}}),o.execute("COMMIT"),console.log("DB TAXO transaction finished"),o.close(),console.log("durationTaxo :"+((new Date).getTime()-s)),Ti.App.Properties.setBool("TSAxxTAXO",!0),!0},Import_loadRecords:function(){var e=(new Date).getTime(),t=Ti.Database.open(DBNAME);t.execute("PRAGMA synchronous = OFF"),t.execute("BEGIN TRANSACTION");var i=this;return this.rows.forEach(function(e,a){if(a>0&&Array.isArray(e.C)&&30==e.C.length){var s=e.C;a%50||i.fireEvent("progress",{progress:a/i.rows.length}),t.execute("INSERT INTO records VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)",s[0],s[1],s[2],s[4],s[5],s[14],s[15],s[16],s[17],s[18],s[19],s[20],s[21],s[22],s[23],s[24],s[25],s[26],s[27],s[28],s[29])}}),t.execute("COMMIT"),console.log("DB transaction finished"),t.close(),console.log("durationRecords :"+((new Date).getTime()-e)+" ms."),Ti.App.Properties.setBool(DBNAME,!0),!0},getAllClasses:function(){for(var e=Ti.Database.open(DBNAME),t=e.execute('SELECT * FROM classes WHERE latin <> ""'),i=[];t.isValidRow();){var a={latin:t.fieldByName("latin"),de:t.fieldByName("de"),en:t.fieldByName("en"),image:"/assets/"+t.fieldByName("latin").toLowerCase()+".png"};i.push(a),t.next()}return t.close(),e.close(),i.sort(function(e,t){return e.latin>t.latin?!0:!1})},getOrdersByClass:function(e){for(var t=Ti.Database.open(DBNAME),i=t.execute("SELECT * FROM orders WHERE classes = ?",e),a=[];i.isValidRow();){var s={latin:i.fieldByName("latin"),de:i.fieldByName("de"),en:i.fieldByName("en"),image:"/assets/"+i.fieldByName("latin").toLowerCase()+".png"};a.push(s),i.next()}return i.close(),t.close(),a.sort(function(e,t){return e.latin>t.latin?!0:!1})},getFamiliesByOrdo:function(e){var t=Ti.Database.open(DBNAME);console.log(e);for(var i=t.execute("SELECT * FROM families WHERE orders = ?",e),a=[];i.isValidRow();){var s={latin:i.fieldByName("latin"),de:i.fieldByName("de"),en:i.fieldByName("en"),image:"/assets/"+i.fieldByName("latin").toLowerCase()+".png"};a.push(s),i.next()}return i.close(),t.close(),console.log(a),a.sort(function(e,t){return e.latin>t.latin?!0:!1})},getSpeciesByFamily:function(e){for(var t=Ti.Database.open(DBNAME),i=t.execute("SELECT * FROM species WHERE families = ?",e),a=[];i.isValidRow();){var s={latin:i.fieldByName("latin"),de:i.fieldByName("de"),en:i.fieldByName("en"),image:"/assets/"+i.fieldByName("latin").toLowerCase()+".png"};a.push(s),i.next()}return i.close(),t.close(),a.sort(function(e,t){return e.latin>t.latin?!0:!1})},getRecordsBySpecies:function(e){for(var t=Ti.Database.open(DBNAME),i=t.execute("SELECT * FROM records WHERE species = ?",e),a=[];i.isValidRow();){var s=i.fieldByName("filename"),r={species:i.fieldByName("species"),deutscher_name:i.fieldByName("deutscher_name")||i.fieldByName("species"),beschreibung:i.fieldByName("Beschreibung"),gps:i.fieldByName("latitude")+","+i.fieldByName("longitude"),mp3:"http://www.tierstimmenarchiv.de/recordings/"+s+"_short.mp3",spectrogram:"http://mm.webmasterei.com/spectrogram/"+s+"_short.mp3.wav.png.jpg",autor:i.fieldByName("autor"),copyright:i.fieldByName("Copyright")};a.push(r),i.next()}return i.close(),t.close(),a},getRecordsWithLatLng:function(){var e=Ti.Database.open(DBNAME);console.log("getRecordsWithLatLng ≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈");for(var t=e.execute("SELECT classes.latin AS class,records.* FROM classes,records,species,families,orders WHERE records.latitude <> 0 AND records.longitude <>0 AND records.species=species.latin AND species.families=families.latin AND families.orders=orders.latin AND orders.classes=classes.latin"),i={};t.isValidRow();){var a=t.fieldByName("filename"),s=t.fieldByName("class");i[s]||(i[s]=[]);var r={itemId:"http://www.tierstimmenarchiv.de/recordings/"+a+"_short.mp3",id:a,image:"/images/"+s+".png",title:t.fieldByName("species"),subtitle:t.fieldByName("Beschreibung"),lat:t.fieldByName("latitude"),lng:t.fieldByName("longitude")};i[s].push(r),t.next()}return t.close(),i},searchAnimals:function(e){for(var t=Ti.Database.open(DBNAME),i=t.execute('SELECT * FROM records WHERE deutscher_name LIKE "%'+e+'%" ORDER BY species LIMIT 500'),a=[];i.isValidRow();){var s=i.fieldByName("filename"),r={species:i.fieldByName("species"),deutscher_name:i.fieldByName("deutscher_name")||i.fieldByName("species"),beschreibung:i.fieldByName("Beschreibung"),gps:i.fieldByName("latitude")+","+i.fieldByName("longitude"),mp3:"http://www.tierstimmenarchiv.de/recordings/"+s+"_short.mp3",spectrogram:"http://mm.webmasterei.com/spectrogram/"+s+"_short.mp3.wav.png.jpg",autor:i.fieldByName("autor"),copyright:i.fieldByName("Copyright")};a.push(r),i.next()}i.close();var n={};return a.forEach(function(e){n[e.species]||(n[e.species]=[]),n[e.species].push(e)}),n},fireEvent:function(e,t){if(this.eventhandlers||(this.eventhandlers={}),this.eventhandlers[e])for(var i=0;i<this.eventhandlers[e].length;i++)this.eventhandlers[e][i].call(this,t)},addEventListener:function(e,t){this.eventhandlers||(this.eventhandlers={}),this.eventhandlers[e]||(this.eventhandlers[e]=[]),this.eventhandlers[e].push(t)},removeEventListener:function(e,t){if(this.eventhandlers||(this.eventhandlers={}),this.eventhandlers[e]){var i=this.eventhandlers[e].filter(function(e){return e!=t});this.eventhandlers[e]=i}}},module.exports=Module;